<div class="flex flex-col min-h-screen bg-gray-100 font-sans text-gray-800">
    <header class="bg-white shadow-sm h-16 flex items-center justify-between px-6 sticky top-0 z-20">
        <h2 class="text-lg font-bold text-[#0B4D6C]">Mi Agenda</h2>
    </header>

    <main class="grow p-6">
        @if (isLoading) {
            <app-loading-spinner message="Cargando agenda..."></app-loading-spinner>
        } @else {
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold text-gray-700">Agenda Semanal</h1>
                <div class="bg-white p-1 rounded-lg border border-gray-200 shadow-sm flex">
                    <button (click)="toggleView(true)" 
                            [class]="vistaCalendario ? 'bg-[#0B4D6C] text-white' : 'text-gray-600 hover:bg-gray-100'"
                            class="px-4 py-2 rounded-md text-sm font-semibold transition flex items-center gap-2">
                        <i class="fa-solid fa-calendar-days"></i> Calendario
                    </button>
                    <button (click)="toggleView(false)" 
                            [class]="!vistaCalendario ? 'bg-[#0B4D6C] text-white' : 'text-gray-600 hover:bg-gray-100'"
                            class="px-4 py-2 rounded-md text-sm font-semibold transition flex items-center gap-2">
                        <i class="fa-solid fa-list"></i> Lista
                    </button>
                </div>
            </div>

            @if (vistaCalendario) {
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden fade-in">
                    <div class="grid grid-cols-7 bg-[#002940] text-white text-center py-2 text-xs md:text-sm font-bold">
                        @for (dia of diasSemana; track $index) {
                            <div class="capitalize">{{ dia | titlecase }}</div>
                        }
                    </div>
                    <div class="grid grid-cols-7 min-h-[400px] divide-x divide-gray-200 bg-gray-50">
                        @for (dia of diasSemana; track $index) {
                            <div class="p-1 md:p-2 relative flex flex-col gap-2">
                                @for (ev of getEventosPorDia(dia); track $index) {
                                    <div [class]="ev.color" class="p-2 rounded text-xs shadow-sm cursor-pointer hover:scale-[1.02] transition">
                                        <span class="font-bold block">{{ ev.horaInicio | slice:0:5 }} - {{ ev.horaFin | slice:0:5 }}</span>
                                        <p class="truncate font-medium">{{ ev.nombreCurso }}</p>
                                        <p class="text-[10px] opacity-80 mt-1">{{ ev.aula }}</p>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                </div>
            }

            @if (!vistaCalendario) {
                <div class="space-y-4 fade-in">
                    @for (dia of diasSemana; track $index) {
                        @if (getEventosPorDia(dia).length > 0) {
                            <div class="flex gap-4">
                                <div class="w-24 text-center py-4 bg-white rounded-lg h-fit border border-gray-100">
                                    <span class="block text-xl font-bold text-gray-700 capitalize">{{ dia | titlecase | slice:0:3 }}</span>
                                    <span class="block text-xs text-gray-500 uppercase">{{ dia }}</span>
                                </div>
                                <div class="grow space-y-3">
                                    @for (ev of getEventosPorDia(dia); track $index) {
                                        <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 transition hover:shadow-md"
                                             [class.border-blue-600]="ev.modalidad === 'Presencial'"
                                             [class.border-purple-600]="ev.modalidad === 'Virtual'">
                                            <div>
                                                <p class="font-bold text-lg text-[#002940]">{{ ev.nombreCurso }}</p>
                                                <div class="flex gap-4 mt-1">
                                                    <p class="text-sm text-gray-500"><i class="fa-regular fa-clock mr-1"></i> {{ ev.horaInicio | slice:0:5 }} - {{ ev.horaFin | slice:0:5 }}</p>
                                                    <p class="text-sm text-gray-500"><i class="fa-solid fa-location-dot mr-1"></i> {{ ev.aula }}</p>
                                                </div>
                                            </div>
                                            <span [class]="ev.modalidad === 'Presencial' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'"
                                                  class="px-3 py-1 rounded-full text-xs font-bold">
                                                {{ ev.modalidad }}
                                            </span>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    }
                </div>
            }
        }
    </main>
</div>